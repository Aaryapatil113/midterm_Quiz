import { useState } from "react";

const questions = [
  {
    meme: "üê∂üî•",
    memeText: "This is fine.",
    memeSubtext: "‚Äî A developer whose CSS is not working",
    question: "Your div is overflowing outside its container. What CSS property fixes it?",
    options: ["overflow: hidden", "display: none", "z-index: 999", "margin: auto"],
    answer: 0,
    explanation: "overflow: hidden clips content that spills outside the container box. Classic box model fix!"
  },
  {
    meme: "ü§î",
    memeText: "Me adding col-12 col-md-6 col-lg-4",
    memeSubtext: "vs. writing 50 lines of media queries manually",
    question: "In Bootstrap, what does col-lg-4 mean?",
    options: [
      "4px wide on large screens",
      "Takes 4 out of 12 columns on large screens (‚â•992px)",
      "The 4th column in the grid",
      "Font size 4 on large screens"
    ],
    answer: 1,
    explanation: "Bootstrap's 12-column grid means col-lg-4 = 4/12 = one-third of the row width on large screens!"
  },
  {
    meme: "üò≠",
    memeText: "My layout on desktop: üòç",
    memeSubtext: "My layout on mobile: üíÄ",
    question: "Which Bootstrap class makes an element full-width on mobile but half-width on tablets?",
    options: ["col-6 col-sm-12", "col-12 col-md-6", "col-md-12 col-sm-6", "col-6"],
    answer: 1,
    explanation: "col-12 = full width by default (mobile first!), col-md-6 = half width at ‚â•768px (tablet+)."
  },
  {
    meme: "üß±",
    memeText: "The CSS Box Model be like:",
    memeSubtext: "margin > border > padding > content... or was it the other way? üëÄ",
    question: "From outermost to innermost, what is the correct CSS Box Model order?",
    options: [
      "Content ‚Üí Padding ‚Üí Border ‚Üí Margin",
      "Margin ‚Üí Border ‚Üí Padding ‚Üí Content",
      "Padding ‚Üí Margin ‚Üí Content ‚Üí Border",
      "Border ‚Üí Margin ‚Üí Content ‚Üí Padding"
    ],
    answer: 1,
    explanation: "Margin (outermost) ‚Üí Border ‚Üí Padding ‚Üí Content (innermost). Think of it like gift wrapping!"
  },
  {
    meme: "üö¶",
    memeText: "Express.js routing be like:",
    memeSubtext: "GET /home ‚Üí here you go | POST /data ‚Üí let me save that | DELETE /me ‚Üí ...üíÄ",
    question: "Which Express code correctly defines a GET route at /listings?",
    options: [
      "app.get('/listings', (req, res) => res.send('ok'))",
      "app.fetch('/listings', (req, res) => res.send('ok'))",
      "express.route('/listings').get()",
      "router('/listings', 'GET')"
    ],
    answer: 0,
    explanation: "app.get(path, callback) is the correct Express syntax. req = request, res = response!"
  }
];

export default function MemeQuiz() {
  const [current, setCurrent] = useState(0);
  const [selected, setSelected] = useState(null);
  const [score, setScore] = useState(0);
  const [done, setDone] = useState(false);
  const [showExp, setShowExp] = useState(false);

  const q = questions[current];

  function handleSelect(i) {
    if (selected !== null) return;
    setSelected(i);
    if (i === q.answer) setScore(s => s + 1);
    setShowExp(true);
  }

  function handleNext() {
    if (current + 1 < questions.length) {
      setCurrent(c => c + 1);
      setSelected(null);
      setShowExp(false);
    } else {
      setDone(true);
    }
  }

  function restart() {
    setCurrent(0);
    setSelected(null);
    setScore(0);
    setDone(false);
    setShowExp(false);
  }

  if (done) {
    const pct = Math.round((score / questions.length) * 100);
    const emoji = pct === 100 ? "üèÜ" : pct >= 60 ? "üòé" : "üíÄ";
    return (
      <div style={{ minHeight: "100vh", background: "linear-gradient(135deg, #1a1a2e, #16213e)", display: "flex", alignItems: "center", justifyContent: "center", fontFamily: "sans-serif", padding: 20 }}>
        <div style={{ background: "#0f3460", borderRadius: 20, padding: 40, maxWidth: 480, width: "100%", textAlign: "center", boxShadow: "0 8px 32px rgba(0,0,0,0.4)" }}>
          <div style={{ fontSize: 80 }}>{emoji}</div>
          <h2 style={{ color: "#e94560", fontSize: 28, margin: "16px 0 8px" }}>Quiz Complete!</h2>
          <p style={{ color: "#a8b2d8", fontSize: 18, marginBottom: 8 }}>You scored</p>
          <div style={{ fontSize: 56, fontWeight: 900, color: "#fff", margin: "8px 0" }}>{score}/{questions.length}</div>
          <div style={{ fontSize: 20, color: pct >= 60 ? "#4ecca3" : "#e94560", marginBottom: 24 }}>{pct}% ‚Äî {pct === 100 ? "Full marks! üéâ" : pct >= 60 ? "Solid work!" : "Keep studying! üìö"}</div>
          <button onClick={restart} style={{ background: "#e94560", color: "#fff", border: "none", borderRadius: 12, padding: "12px 32px", fontSize: 16, cursor: "pointer", fontWeight: 700 }}>
            üîÑ Try Again
          </button>
        </div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: "100vh", background: "linear-gradient(135deg, #1a1a2e, #16213e)", display: "flex", alignItems: "center", justifyContent: "center", fontFamily: "sans-serif", padding: 20 }}>
      <div style={{ maxWidth: 540, width: "100%" }}>

        {/* Progress */}
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }}>
          <span style={{ color: "#a8b2d8", fontSize: 14 }}>Question {current + 1} of {questions.length}</span>
          <span style={{ color: "#4ecca3", fontSize: 14, fontWeight: 700 }}>Score: {score}</span>
        </div>
        <div style={{ background: "#0f3460", borderRadius: 8, height: 6, marginBottom: 24 }}>
          <div style={{ background: "#e94560", height: 6, borderRadius: 8, width: `${((current) / questions.length) * 100}%`, transition: "width 0.4s" }} />
        </div>

        {/* Meme Card */}
        <div style={{ background: "#0f3460", borderRadius: 20, padding: 28, marginBottom: 20, textAlign: "center", boxShadow: "0 4px 24px rgba(0,0,0,0.3)" }}>
          <div style={{ fontSize: 52, marginBottom: 8 }}>{q.meme}</div>
          <div style={{ color: "#fff", fontSize: 18, fontWeight: 700, marginBottom: 4 }}>{q.memeText}</div>
          <div style={{ color: "#a8b2d8", fontSize: 13, fontStyle: "italic" }}>{q.memeSubtext}</div>
        </div>

        {/* Question */}
        <div style={{ background: "#0f3460", borderRadius: 20, padding: 28, boxShadow: "0 4px 24px rgba(0,0,0,0.3)" }}>
          <p style={{ color: "#fff", fontSize: 16, fontWeight: 600, marginBottom: 20, lineHeight: 1.5 }}>{q.question}</p>

          <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
            {q.options.map((opt, i) => {
              let bg = "#1a1a2e";
              let border = "2px solid #1a1a2e";
              let color = "#a8b2d8";
              if (selected !== null) {
                if (i === q.answer) { bg = "#1a3a2a"; border = "2px solid #4ecca3"; color = "#4ecca3"; }
                else if (i === selected && i !== q.answer) { bg = "#3a1a1a"; border = "2px solid #e94560"; color = "#e94560"; }
              }
              return (
                <button key={i} onClick={() => handleSelect(i)} style={{ background: bg, border, borderRadius: 12, padding: "12px 16px", color, fontSize: 14, textAlign: "left", cursor: selected === null ? "pointer" : "default", transition: "all 0.2s", fontFamily: "sans-serif", lineHeight: 1.4 }}>
                  <span style={{ fontWeight: 700, marginRight: 8 }}>{["A", "B", "C", "D"][i]}.</span>{opt}
                  {selected !== null && i === q.answer && <span style={{ float: "right" }}>‚úÖ</span>}
                  {selected === i && i !== q.answer && <span style={{ float: "right" }}>‚ùå</span>}
                </button>
              );
            })}
          </div>

          {/* Explanation */}
          {showExp && (
            <div style={{ marginTop: 16, background: "#1a1a2e", borderRadius: 12, padding: 14, borderLeft: "4px solid #4ecca3" }}>
              <span style={{ color: "#4ecca3", fontWeight: 700, fontSize: 13 }}>üí° Explanation: </span>
              <span style={{ color: "#a8b2d8", fontSize: 13 }}>{q.explanation}</span>
            </div>
          )}

          {selected !== null && (
            <button onClick={handleNext} style={{ marginTop: 20, width: "100%", background: "#e94560", color: "#fff", border: "none", borderRadius: 12, padding: "13px", fontSize: 15, cursor: "pointer", fontWeight: 700 }}>
              {current + 1 < questions.length ? "Next Question ‚Üí" : "See Results üèÜ"}
            </button>
          )}
        </div>
      </div>
    </div>
  );
}
